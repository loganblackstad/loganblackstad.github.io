---
title: "Using Bigram Paragraph Vectors for Concept Detection"
author_profile: false
author: Tim Dobbins
excerpt: Recently, I was working on a project using paragraph vectors at work (with gensim's Doc2Vec model) and noticed that the Doc2Vec model didn't natively interact well with their Phrases class, and there was no easy workaround (that I noticed).
categories: [2018, august]
tags: [python, data-science, nlp, machine-learning]
---
<link rel="stylesheet" type="text/css" href="/assets/css/ipython.css"><style>

div.output_area{max-height:500px;}
</style><div class="cell text_cell rendered " tabs="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59375px; left: 5.59375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px; width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: 0px; border-right-width: 30px; min-height: 402px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" style=""><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">Recently, I was working on a project using paragraph vectors at work (with gensim's <span class="cm-comment">`Doc2Vec`</span> model) and noticed that the <span class="cm-comment">`Doc2Vec`</span> model didn't natively interact well with their <span class="cm-comment">`Phrases`</span> class, and there was no easy workaround (that I noticed). I saw <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">a</span> <span class="cm-attribute">href</span>=<span class="cm-string">"</span><span class="cm-string cm-link">http://lmgtfy.com/?q=bigrams+doc2vec+gensim</span><span class="cm-string">"</span><span class="cm-tag cm-bracket">&gt;</span>very little activity<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">a</span><span class="cm-tag cm-bracket">&gt;</span> around the interwebs about using bigrams with paragraph vectors, which I thought was surprising since paragraph vectors can be much more illuminating than word vectors, especially when trying to disambiguate the various meanings of a given text. This is the main reason I was looking to move from bigram word vectors to bigram <span class="cm-em">*paragraph*</span> vectors.</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text=""></span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">So I decided to take a look at <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">a</span> <span class="cm-attribute">href</span>=<span class="cm-string">"</span><span class="cm-string cm-link">https://github.com/RaRe-Technologies/gensim</span><span class="cm-string">"</span><span class="cm-tag cm-bracket">&gt;</span>gensim's source code<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">a</span><span class="cm-tag cm-bracket">&gt;</span> and incorporate this interaction into its API. With this commit, you can build paragraph vectors with unigrams <span class="cm-em">*and*</span> bigrams by only passing an additional argument to the <span class="cm-comment">`Phrases`</span> class. If you want to dig into the code I added, you can find it <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">a</span> <span class="cm-attribute">href</span>=<span class="cm-string">"</span><span class="cm-string cm-link">https://github.com/RaRe-Technologies/gensim/pull/2158/files</span><span class="cm-string">"</span><span class="cm-tag cm-bracket">&gt;</span>on github<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">a</span><span class="cm-tag cm-bracket">&gt;</span>. Here, I'll just explain how to use this new code to detect concepts, something I have to do quite often. </span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text=""></span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">First, let's create a helper class to stream in our documents, much like we did in my <span class="cm-tag cm-bracket">&lt;</span><span class="cm-tag">a</span> <span class="cm-attribute">href</span>=<span class="cm-string">"</span><span class="cm-string cm-link">https://tmthyjames.github.io/posts/Analyzing-Rap-Lyrics-Using-Word-Vectors/</span><span class="cm-string">"</span><span class="cm-tag cm-bracket">&gt;</span>previous post<span class="cm-tag cm-bracket">&lt;/</span><span class="cm-tag">a</span><span class="cm-tag cm-bracket">&gt;</span> on analyzing rap lyrics with word vectors. Since the <span class="cm-comment">`Doc2Vec`</span> model accepts as input a <span class="cm-comment">`TaggedDocument`</span> object, that's what we'll <span class="cm-comment">`yield`</span> from our <span class="cm-comment">`__iter__`</span> method. </span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 432px;"></div></div></div></div><div class="text_cell_render rendered_html" tabs="-1"><p>Recently, I was working on a project using paragraph vectors at work (with gensim's <code>Doc2Vec</code> model) and noticed that the <code>Doc2Vec</code> model didn't natively interact well with their <code>Phrases</code> class, and there was no easy workaround (that I noticed). I saw <a href="http://lmgtfy.com/?q=bigrams+doc2vec+gensim" target="_blank">very little activity</a> around the interwebs about using bigrams with paragraph vectors, which I thought was surprising since paragraph vectors can be much more illuminating than word vectors, especially when trying to disambiguate the various meanings of a given text. This is the main reason I was looking to move from bigram word vectors to bigram <em>paragraph</em> vectors.</p>
<p>So I decided to take a look at <a href="https://github.com/RaRe-Technologies/gensim" target="_blank">gensim's source code</a> and incorporate this interaction into its API. With this commit, you can build paragraph vectors with unigrams <em>and</em> bigrams by only passing an additional argument to the <code>Phrases</code> class. If you want to dig into the code I added, you can find it <a href="https://github.com/RaRe-Technologies/gensim/pull/2158/files" target="_blank">on github</a>. Here, I'll just explain how to use this new code to detect concepts, something I have to do quite often. </p>
<p>First, let's create a helper class to stream in our documents, much like we did in my <a href="https://tmthyjames.github.io/posts/Analyzing-Rap-Lyrics-Using-Word-Vectors/" target="_blank">previous post</a> on analyzing rap lyrics with word vectors. Since the <code>Doc2Vec</code> model accepts as input a <code>TaggedDocument</code> object, that's what we'll <code>yield</code> from our <code>__iter__</code> method. </p>
</div></div></div><div class="cell code_cell rendered un" tabs="2"><div class="input"><div class="prompt input_prompt">In&nbsp;[509]:</div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59375px; left: 259.528px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="width: 18px; pointer-events: none; bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 518.455px; margin-bottom: 0px; border-right-width: 30px; min-height: 470px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors" style=""></div><div class="CodeMirror-code" style=""><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">gensim</span>.<span class="cm-property">models</span>.<span class="cm-property">doc2vec</span> <span class="cm-keyword cm-cm-overlay cm-matchhighlight">import</span> <span class="cm-variable">TaggedDocument</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword cm-cm-overlay cm-matchhighlight">import</span> <span class="cm-variable">nltk</span>, <span class="cm-variable">csv</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text=""></span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">class</span> <span class="cm-def">Sentences</span>(<span class="cm-builtin">object</span>):</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    </span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-keyword">def</span> <span class="cm-def">__init__</span>(<span class="cm-variable-2">self</span>, <span class="cm-variable">filename</span>=<span class="cm-keyword">None</span>, <span class="cm-variable">col</span>=<span class="cm-keyword">None</span>, </span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">                 <span class="cm-variable">stopwords</span>=<span class="cm-keyword">None</span>, <span class="cm-variable">ID</span>=<span class="cm-keyword">None</span>):</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        <span class="cm-variable-2">self</span>.<span class="cm-property">filename</span> = <span class="cm-variable">filename</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        <span class="cm-variable-2">self</span>.<span class="cm-property">col</span> = <span class="cm-variable">col</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        <span class="cm-variable-2">self</span>.<span class="cm-property">stopwords</span> = <span class="cm-variable">stopwords</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        <span class="cm-variable-2">self</span>.<span class="cm-property">ID</span> = <span class="cm-variable">ID</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        </span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-meta">@staticmethod</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-keyword">def</span> <span class="cm-def">get_tokens</span>(<span class="cm-variable">text</span>):</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        <span class="cm-string">"""Helper function for retrieving for tokenizing data, </span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-string">           ignoring stemming and lemmatizing here for simplicity"""</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        <span class="cm-keyword">return</span> [<span class="cm-variable">r</span>.<span class="cm-property">lower</span>() <span class="cm-keyword">for</span> <span class="cm-variable">r</span> <span class="cm-keyword">in</span> <span class="cm-variable">text</span>.<span class="cm-property">split</span>()]</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"> </span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-null cm-error">    </span><span class="cm-keyword">def</span> <span class="cm-def">__iter__</span>(<span class="cm-variable-2">self</span>):</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        <span class="cm-variable">reader</span> = <span class="cm-variable">csv</span>.<span class="cm-property">DictReader</span>(<span class="cm-builtin">open</span>(<span class="cm-variable-2">self</span>.<span class="cm-property">filename</span>, <span class="cm-string">'r'</span> ))</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        <span class="cm-keyword">for</span> <span class="cm-variable">row</span> <span class="cm-keyword">in</span> <span class="cm-variable">reader</span>:</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">            <span class="cm-variable">song</span> = <span class="cm-variable">row</span>[<span class="cm-variable-2">self</span>.<span class="cm-property">ID</span>]</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">            <span class="cm-keyword">if</span> <span class="cm-keyword">not</span> <span class="cm-variable">row</span>[<span class="cm-variable-2">self</span>.<span class="cm-property">col</span>]: <span class="cm-keyword">continue</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">            <span class="cm-variable">words</span> = <span class="cm-variable-2">self</span>.<span class="cm-property">get_tokens</span>(<span class="cm-variable">row</span>[<span class="cm-variable-2">self</span>.<span class="cm-property">col</span>])</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">            <span class="cm-variable">tags</span> = [<span class="cm-string">'%s'</span> <span class="cm-operator">%</span> (<span class="cm-variable">row</span>[<span class="cm-variable-2">self</span>.<span class="cm-property">ID</span>].<span class="cm-property">strip</span>())]</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">            <span class="cm-keyword">yield</span> <span class="cm-variable">TaggedDocument</span>(<span class="cm-variable">words</span>=<span class="cm-variable">words</span>, <span class="cm-variable">tags</span>=<span class="cm-variable">tags</span>)</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text=""></span></span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 500px;"></div></div></div></div></div></div><div class="widget-area" style="display: none;"><div class="prompt"><button class="close">×</button></div><div class="widget-subarea"></div></div><div class="output_wrapper"><div class=" prompt" title="click to expand output; double click to hide output" style="display: none;"></div><div class="output" style="display: none;"></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell text_cell rendered un" tabs="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59656px; left: 5.59658px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px; width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: 0px; border-right-width: 30px; min-height: 44px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">Now let's initialize a <span class="cm-comment">`Sentences`</span> object and pass in the <span class="cm-comment">`id`</span> column so that we can tag each document with an identifier. </span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 74px;"></div></div></div></div><div class="text_cell_render rendered_html" tabs="-1"><p>Now let's initialize a <code>Sentences</code> object and pass in the <code>id</code> column so that we can tag each document with an identifier. </p>
</div></div></div><div class="cell code_cell rendered un" tabs="2"><div class="input"><div class="prompt input_prompt">In&nbsp;[511]:</div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59375px; left: 5.59375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 634px; margin-bottom: 0px; border-right-width: 30px; min-height: 113px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" style=""><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable cm-cm-overlay cm-matchhighlight">sentences</span> = <span class="cm-variable">Sentences</span>(</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-variable">filename</span>=<span class="cm-string">'rap-lyrics.csv'</span>, <span class="cm-comment"># our filename</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-variable">col</span>=<span class="cm-string">'lyric'</span>, <span class="cm-comment"># the text field</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-variable">ID</span>=<span class="cm-string">'id'</span>, <span class="cm-comment"># our ID column for document tagging</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-variable">stopwords</span>=<span class="cm-variable">nltk</span>.<span class="cm-property">corpus</span>.<span class="cm-property">stopwords</span>.<span class="cm-property">words</span>(<span class="cm-string">'english'</span>) <span class="cm-comment"># default stopwords from NLTK</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">)</span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 143px;"></div></div></div></div></div></div><div class="widget-area" style="display: none;"><div class="prompt"><button class="close">×</button></div><div class="widget-subarea"></div></div><div class="output_wrapper"><div class=" prompt" title="click to expand output; double click to hide output" style="display: none;"></div><div class="output" style="display: none;"></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell text_cell rendered un" tabs="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59656px; left: 5.59658px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px; width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: 0px; border-right-width: 30px; min-height: 109px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">Previous to this commit, you had to pass a list of strings to the <span class="cm-comment">`Phrases`</span> class in gensim, which is fine if you pass the output of <span class="cm-comment">`Phrases`</span> to the <span class="cm-comment">`Word2Vec`</span> model since that's exactly what the <span class="cm-comment">`Word2Vec`</span> model expects. But <span class="cm-comment">`Doc2vec`</span> expects a list (or any iterable) of <span class="cm-comment">`TaggedDocument`</span> objects. This is really the only thing preventing the easy use of bigrams with <span class="cm-comment">`Doc2Vec`</span>. So let's initialize a <span class="cm-comment">`Phrases`</span> object and pass our <span class="cm-comment">`doc2vec`</span> argument in.</span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 139px;"></div></div></div></div><div class="text_cell_render rendered_html" tabs="-1"><p>Previous to this commit, you had to pass a list of strings to the <code>Phrases</code> class in gensim, which is fine if you pass the output of <code>Phrases</code> to the <code>Word2Vec</code> model since that's exactly what the <code>Word2Vec</code> model expects. But <code>Doc2vec</code> expects a list (or any iterable) of <code>TaggedDocument</code> objects. This is really the only thing preventing the easy use of bigrams with <code>Doc2Vec</code>. So let's initialize a <code>Phrases</code> object and pass our <code>doc2vec</code> argument in.</p>
</div></div></div><div class="cell code_cell rendered un" tabs="2"><div class="input"><div class="prompt input_prompt">In&nbsp;[481]:</div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59375px; left: 5.59375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 326.203px; margin-bottom: 0px; border-right-width: 30px; min-height: 28px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable cm-cm-overlay cm-matchhighlight">phrases</span> = <span class="cm-variable">Phrases</span>(<span class="cm-variable">sentences</span>, <span class="cm-variable">doc2vec</span>=<span class="cm-keyword">True</span>)</span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 58px;"></div></div></div></div></div></div><div class="widget-area" style="display: none;"><div class="prompt"><button class="close">×</button></div><div class="widget-subarea"></div></div><div class="output_wrapper"><div class=" prompt" title="click to expand output; double click to hide output" style="display: none;"></div><div class="output" style="display: none;"></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell text_cell rendered un" tabs="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59656px; left: 5.59658px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px; width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: 0px; border-right-width: 30px; min-height: 125px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">To those familiar with gensim's API, the only difference in the workflow is that now you must set <span class="cm-comment">`doc2vec=True`</span> when initializing the <span class="cm-comment">`Phrases`</span> object. That's it! <span class="cm-strong">**Now you can leverage the insight of bigrams while harnessing the totality of document-level vectors**</span>. The following is the code I used to train a <span class="cm-comment">`Word2vec`</span> model using bigrams (phrases), but just replacing <span class="cm-comment">`Word2Vec`</span> with <span class="cm-comment">`Doc2vec`</span>. Previously, it would error out because the two weren't compatiable. Now they interact seemlessly.</span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 155px;"></div></div></div></div><div class="text_cell_render rendered_html" tabs="-1"><p>To those familiar with gensim's API, the only difference in the workflow is that now you must set <code>doc2vec=True</code> when initializing the <code>Phrases</code> object. That's it! <strong>Now you can leverage the insight of bigrams while harnessing the totality of document-level vectors</strong>. The following is the code I used to train a <code>Word2vec</code> model using bigrams (phrases), but just replacing <code>Word2Vec</code> with <code>Doc2vec</code>. Previously, it would error out because the two weren't compatiable. Now they interact seemlessly.</p>
</div></div></div><div class="cell code_cell rendered un" tabs="2"><div class="input"><div class="prompt input_prompt">In&nbsp;[482]:</div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59375px; left: 320.594px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="width: 18px; pointer-events: none; bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 803.344px; margin-bottom: 0px; border-right-width: 30px; min-height: 300px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors" style=""></div><div class="CodeMirror-code" style=""><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">from</span> <span class="cm-variable">gensim</span>.<span class="cm-property">models</span>.<span class="cm-property">doc2vec</span> <span class="cm-keyword">import</span> <span class="cm-variable cm-cm-overlay cm-matchhighlight">Doc2Vec</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text=""></span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">phrase2vec</span> = <span class="cm-variable cm-cm-overlay cm-matchhighlight">Doc2Vec</span>( </span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-variable">workers</span>=<span class="cm-number">5</span>, </span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-variable">window</span>=<span class="cm-number">20</span>, </span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-variable">alpha</span>=<span class="cm-number">0.025</span>, </span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-variable">min_alpha</span>=<span class="cm-number">0.025</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-variable">min_count</span>=<span class="cm-number">1</span>,</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">)</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text=""></span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">phrase2vec</span>.<span class="cm-property">build_vocab</span>(<span class="cm-variable">phrases</span>[<span class="cm-variable">sentences</span>])</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">for</span> <span class="cm-variable">epoch</span> <span class="cm-keyword">in</span> <span class="cm-builtin">range</span>(<span class="cm-number">3</span>):</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-variable">phrase2vec</span>.<span class="cm-property">train</span>(<span class="cm-variable">phrases</span>[<span class="cm-variable">sentences</span>], <span class="cm-variable">total_examples</span>=<span class="cm-variable">phrase2vec</span>.<span class="cm-property">corpus_count</span>, <span class="cm-variable">epochs</span>=<span class="cm-variable">phrase2vec</span>.<span class="cm-property">iter</span>)</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-variable">phrase2vec</span>.<span class="cm-property">alpha</span> -= <span class="cm-number">0.002</span>  <span class="cm-comment"># decrease the learning rate</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-variable">phrase2vec</span>.<span class="cm-property">min_alpha</span> = <span class="cm-variable">phrase2vec</span>.<span class="cm-property">alpha</span>  <span class="cm-comment"># fix the learning rate, no decay</span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text=""></span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable">phrase2vec</span>.<span class="cm-property">save</span>(<span class="cm-string">'rap-lyrics3.bigrams.doc2vec'</span>)</span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 330px;"></div></div></div></div></div></div><div class="widget-area" style="display: none;"><div class="prompt"><button class="close">×</button></div><div class="widget-subarea"></div></div><div class="output_wrapper"><div class=" prompt" title="click to scroll output; double click to hide" style=""></div><div class="output" style=""><div class="output_area"><div class="prompt"></div><div class="output_subarea output_text output_stream output_stderr"><pre>/home/ubuntu/anaconda3/lib/python3.6/site-packages/ipykernel_launcher.py:561: UserWarning: For a faster implementation, use the gensim.models.phrases.Phraser class
</pre></div></div></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell text_cell rendered un" tabs="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59656px; left: 5.59658px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="bottom: 0px; width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; padding-right: 0px; padding-bottom: 0px; margin-bottom: 0px; border-right-width: 30px; min-height: 44px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">Now, let's use these bigram paragraph vectors to detect various concepts. We'll use rap lyrics since I have those on my machine already. </span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 74px;"></div></div></div></div><div class="text_cell_render rendered_html" tabs="-1"><p>Now, let's use these bigram paragraph vectors to detect various concepts. We'll use rap lyrics since I have those on my machine already. </p>
</div></div></div><div class="cell code_cell rendered un" tabs="2"><div class="input"><div class="prompt input_prompt">In&nbsp;[500]:</div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59375px; left: 5.59375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="width: 18px; pointer-events: none; bottom: 0px;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 541.734px; margin-bottom: 0px; border-right-width: 30px; min-height: 266px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code" style=""><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable cm-cm-overlay cm-matchhighlight">concepts</span> = [<span class="cm-string">'weed'</span>, <span class="cm-string">'mom'</span>, <span class="cm-string">'religion'</span>, <span class="cm-string">'party'</span>, <span class="cm-string">'spanish'</span>, <span class="cm-string">'politics'</span>]</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text=""></span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-keyword">for</span> <span class="cm-variable">concept</span> <span class="cm-keyword">in</span> <span class="cm-variable cm-cm-overlay cm-matchhighlight">concepts</span>:</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-variable">query</span> = <span class="cm-variable">concept</span>.<span class="cm-property">split</span>()</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text=""></span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-variable">scores</span> = <span class="cm-variable">pd</span>.<span class="cm-property">DataFrame</span>(</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        <span class="cm-variable">phrase2vec</span>.<span class="cm-property">docvecs</span>.<span class="cm-property">most_similar</span>(</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">            <span class="cm-variable">phrase2vec</span>[<span class="cm-variable">query</span>], </span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">            <span class="cm-variable">topn</span>=<span class="cm-builtin">len</span>(<span class="cm-variable">lyrics</span>)</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        ), </span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">        <span class="cm-variable">columns</span>=[<span class="cm-string">'id'</span>, <span class="cm-variable">concept</span> <span class="cm-operator">+</span> <span class="cm-string">'_concept'</span>]</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    )</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span cm-text=""></span></span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-variable">scores</span>[<span class="cm-string">'id'</span>] = <span class="cm-variable">scores</span>[<span class="cm-string">'id'</span>].<span class="cm-property">astype</span>(<span class="cm-builtin">int</span>)</span></pre><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">    <span class="cm-variable">lyrics</span> = <span class="cm-variable">lyrics</span>.<span class="cm-property">merge</span>(<span class="cm-variable">scores</span>, <span class="cm-variable">on</span>=[<span class="cm-string">'id'</span>])</span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 296px;"></div></div></div></div></div></div><div class="widget-area" style="display: none;"><div class="prompt"><button class="close">×</button></div><div class="widget-subarea"></div></div><div class="output_wrapper"><div class=" prompt" title="click to expand output; double click to hide output" style="display: none;"></div><div class="output" style="display: none;"></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell code_cell rendered un" tabs="2"><div class="input"><div class="prompt input_prompt">In&nbsp;[501]:</div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-ipython"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 5.59375px; left: 5.59375px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; min-width: 480px; margin-bottom: 0px; border-right-width: 30px; min-height: 28px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors"></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;"><span class="cm-variable cm-cm-overlay cm-matchhighlight">lyrics</span>.<span class="cm-property">sort_values</span>(<span class="cm-string">'politics_concept'</span>, <span class="cm-variable">ascending</span>=<span class="cm-keyword">False</span>).<span class="cm-property">head</span>()</span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 58px;"></div></div></div></div></div></div><div class="widget-area" style="display: none;"><div class="prompt"><button class="close">×</button></div><div class="widget-subarea"></div></div><div class="output_wrapper"><div class=" prompt" title="click to unscroll output; double click to hide" style=""></div><div class="output " style=""><div class="output_area"><div class="prompt output_prompt">Out[501]:</div><div class="output_subarea output_html rendered_html output_result"><div>

<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right">
      <th></th>
      <th>id</th>
      <th>song</th>
      <th>year</th>
      <th>album</th>
      <th>artist</th>
      <th>lyric</th>
      <th>weed_concept</th>
      <th>mom_concept</th>
      <th>religion_concept</th>
      <th>party_concept</th>
      <th>spanish_concept</th>
      <th>politics_concept</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>10036</th>
      <td>10036</td>
      <td>The Wormhole</td>
      <td>2013.0</td>
      <td>Gravitas (2013)</td>
      <td>Talib_Kweli</td>
      <td>symbologists at the college oh you n****s wann...</td>
      <td>-0.011319</td>
      <td>0.059534</td>
      <td>0.451099</td>
      <td>0.049866</td>
      <td>0.076093</td>
      <td>0.462608</td>
    </tr>
    <tr>
      <th>8963</th>
      <td>8963</td>
      <td>Speak Your Mind (Hidden Track)</td>
      <td>2001.0</td>
      <td>Revolutionary Vol. 1 (2001)</td>
      <td>Immortal_Technique</td>
      <td>you have to speak the truth you have to speak ...</td>
      <td>0.047033</td>
      <td>0.066683</td>
      <td>0.477586</td>
      <td>-0.000200</td>
      <td>0.032641</td>
      <td>0.461523</td>
    </tr>
    <tr>
      <th>4663</th>
      <td>4663</td>
      <td>I Want to Talk to You</td>
      <td>1999.0</td>
      <td>I Am (1999)</td>
      <td>Nas</td>
      <td>chorus repeat 2x i wanna talk to the mayor the...</td>
      <td>-0.112713</td>
      <td>0.040988</td>
      <td>0.299852</td>
      <td>-0.011642</td>
      <td>0.187577</td>
      <td>0.460955</td>
    </tr>
    <tr>
      <th>8861</th>
      <td>8861</td>
      <td>Solidified</td>
      <td>2003.0</td>
      <td>Free Agents: The Murda Mixtape (2003)</td>
      <td>Mobb_Deep</td>
      <td>prodigy yeah you know the shit dont stop never...</td>
      <td>-0.083604</td>
      <td>0.032377</td>
      <td>0.175557</td>
      <td>-0.128048</td>
      <td>0.116116</td>
      <td>0.431326</td>
    </tr>
    <tr>
      <th>7243</th>
      <td>7243</td>
      <td>Open Your Eyes</td>
      <td>2008.0</td>
      <td>The 3rd World (2008)</td>
      <td>Immortal_Technique</td>
      <td>were here because of you were here because you...</td>
      <td>-0.035662</td>
      <td>0.011329</td>
      <td>0.379785</td>
      <td>-0.144915</td>
      <td>0.059664</td>
      <td>0.424974</td>
    </tr>
  </tbody>
</table>
</div></div></div></div><div class="btn btn-default output_collapsed" title="click to expand output" style="display: none;">. . .</div></div></div><div class="cell text_cell rendered un" tabs="2"><div class="prompt input_prompt"></div><div class="inner_cell"><div class="input_area"><div class="CodeMirror cm-s-default CodeMirror-wrap"><div style="overflow: hidden; position: relative; width: 3px; height: 0px; top: 70.5966px; left: 605.597px;"><textarea autocorrect="off" autocapitalize="off" spellcheck="false" tabs="0" style="position: absolute; padding: 0px; width: 1000px; height: 1em; outline: none;"></textarea></div><div class="CodeMirror-vscrollbar" cm-not-content="true" style="width: 18px; pointer-events: none;"><div style="min-width: 1px; height: 0px;"></div></div><div class="CodeMirror-scrollbar-filler" cm-not-content="true"></div><div class="CodeMirror-gutter-filler" cm-not-content="true"></div><div class="CodeMirror-scroll" tabs="-1"><div class="CodeMirror-sizer" style="margin-left: 0px; margin-bottom: 0px; border-right-width: 30px; min-height: 93px; padding-right: 0px; padding-bottom: 0px;"><div style="position: relative; top: 0px;"><div class="CodeMirror-lines"><div style="position: relative; outline: none;"><div class="CodeMirror-measure"><pre><span>xxxxxxxxxx</span></pre></div><div class="CodeMirror-measure"></div><div style="position: relative; z-index: 1;"></div><div class="CodeMirror-cursors" style=""></div><div class="CodeMirror-code"><pre class=" CodeMirror-line "><span style="padding-right: 0.1px;">Our model does a pretty good job of detecting very high level concepts, as you can see with our politics example. I won't show the entire songs since most are NSFW, but you can look these songs up and see for yourself. For the rap connoisseurs out there, you can tell immediately from the artists that these are artists who wear their politics on their sleeves—especially Talib Kweli and Immortal Technique.</span></pre></div></div></div></div></div><div class="CodeMirror-gutters" style="display: none; height: 123px;"></div></div></div></div><div class="text_cell_render rendered_html" tabs="-1"><p>Our model does a pretty good job of detecting very high level concepts, as you can see with our politics example. I won't show the entire songs since most are NSFW, but you can look these songs up and see for yourself. For the rap connoisseurs out there, you can tell immediately from the artists that these are artists who wear their politics on their sleeves—especially Talib Kweli and Immortal Technique.</p>
</div></div></div>